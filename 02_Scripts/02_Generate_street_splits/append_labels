import h5py
import pandas as pd
import pickle

# Note: on the EC2 instance I renamed 'gsv_train_images' to 'street_train' .pkl and .h5

files = {'street_dev': 'label', 'street_test': 'label', 'street_train': 'value'}

for img_base_file in files:
    print('[INFO] Processing {}'.format(img_base_file))
    h5_filename = img_base_file + '.h5'
    pkl_filename = img_base_file + '.pkl'

    # Open h5 file in append mode
    imgs = h5py.File(h5_filename, 'a')

    # Open the labels file
    labels = pickle.load(open(pkl_filename, 'rb'))

    # Convert labels to float
    lab_column = labels[files[img_base_file]]

    # Append the labels column only
    imgs.create_dataset('Y', data=lab_column.astype('float'), compression='gzip')

    # Close the h5 file
    imgs.close()